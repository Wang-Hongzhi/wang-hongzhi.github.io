<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wanghongzhi233.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://wanghongzhi233.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wanghongzhi233.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://wanghongzhi233.github.io/2020/04/22/Vscode_STM32/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/22/Vscode_STM32/" class="post-title-link" itemprop="url">VScode+STM32CubeMX开发STM32</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-22 22:41:39" itemprop="dateCreated datePublished" datetime="2020-04-22T22:41:39+08:00">2020-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-24 18:25:24" itemprop="dateModified" datetime="2020-04-24T18:25:24+08:00">2020-04-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="VScode-STM32CubeMX开发STM32"><a href="#VScode-STM32CubeMX开发STM32" class="headerlink" title="VScode+STM32CubeMX开发STM32"></a>VScode+STM32CubeMX开发STM32</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​    之前一直使用的Keil+STM32CubeMX来进行的32程序开发，但是Keil的界面着实不好看，自动补全啥的也不太好使，加上本人喜欢使用<code>UTF-8</code>作为文件编码,而网络上找的大部分例程都是<code>GB2312</code>的编码，转换起来很麻烦，VScode拥有许多插件可以自动进行编码转换，格式化代码，自动补全啥的都不错，之前尝试过使用VScode进行编辑，使用Keil进行编译调试，但是这样的话两个软件切换起来也很麻烦就放弃了，之前的Keil版本还有如果工程路径有中文进入调试后如果没有删除所有断点就退出调试就会出现Keil卡死不动的情况，虽然最新的MDK529解决了这个问题，但是最近也在学习嵌入式Linux，没有IDE可以用，使用的ARM_GCC和Makefile进行程序编译，所以准备STM32的开发也用这种方法，利用ARM_GCC以及VScode进行程序编写和编译，利用OpenOCD和Jlink进行调试。VScode的界面确实漂亮，有很多主题可用，也有很多插件方便开发。</p>
<p><img src="https://xz-img.oss-cn-beijing.aliyuncs.com/img/20200413214033.png" alt="image-20200413214025911"></p>
<h2 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h2><ul>
<li><a href="https://code.visualstudio.com/" target="_blank" rel="noopener">VScode</a>:官网下载最新版就行。</li>
<li><a href="https://git-scm.com/" target="_blank" rel="noopener">Git</a>:Git是一个分散式版本控制软件，这篇文章不讲他跟版本控制有关的部分，安装Git只是用到他带的Git Bash这个终端。</li>
<li><a href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads" target="_blank" rel="noopener">GNU Arm Embedded Toolchain</a>:STM32是ARM内核的芯片，这个交叉编译工具链包含了所有用于交叉编译ARM内核程序的软件，我这里使用的是<code>gcc-arm-none-eabi-9-2019-q4-major-win32.exe</code>这个Windows上的最新版的，如果是在别的系统上搭建只需要选择对应系统版本的即可。</li>
<li><a href="https://gnutoolchains.com/mingw64/" target="_blank" rel="noopener">MinGW</a>:MinGW是将GCC编译器和GNU Binutils移植到Windows平台下的产物，包括一系列头文件、库和可执行文件。这里选用的是64位版的MinGW，主要使用其中的make工具。</li>
<li><a href="https://gnutoolchains.com/arm-eabi/openocd/" target="_blank" rel="noopener">OpenOCD</a>:OpenOCD（Open On-Chip Debugger）开源片上调试器，是一款开源软件，最初是由Dominic Rath同学还在大学期间发起的（2005年）项目。OpenOCD旨在提供针对嵌入式设备的调试、系统编程和边界扫描功能。OpenOCD在这里的作用就是连接Jlink，STlink等仿真器进行程序下载或者调试。这里给出的链接是已经预编译好的可执行文件。</li>
<li><a href="https://www.segger.com/downloads/jlink/#J-LinkSoftwareAndDocumentationPack" target="_blank" rel="noopener"> J-Link Software and Documentation Pack</a>:Jlink的驱动以及各种相关软件，这篇文章里Jlink没有使用OpenOCD进行连接而是使用的JlinkGDBSever和JFlash进行的调试以及程序下载。当然使用OpenOCD也是没有问题的，只是配置文件有一些区别。</li>
<li><a href="https://www.st.com/zh/development-tools/stm32cubemx.html" target="_blank" rel="noopener">STM32CubeMX</a>:STM32CubeMX是一个图形化的工具，也是配置和初始化C代码生成器（STM32 configuration and initialization C code generation），也就是自动生成开发初期关于芯片相关的一些初始化代码。简单来说就是通过鼠标点一点来设置各种外设的参数，然后一键生成包含自己设置的这些外设底层驱动的工程框架，STM32CubeMX生成的代码使用的是HAL库。</li>
</ul>
<h2 id="搭建流程"><a href="#搭建流程" class="headerlink" title="搭建流程"></a>搭建流程</h2><h3 id="软件安装及配置"><a href="#软件安装及配置" class="headerlink" title="软件安装及配置"></a>软件安装及配置</h3><h4 id="VSCode"><a href="#VSCode" class="headerlink" title="VSCode"></a>VSCode</h4><p>​    正常安装VScode，然后安装一些需要的插件。</p>
<p>​    在VScode中使用快捷键<code>Ctrl</code>+<code>Shift</code>+<code>P</code>，打开命令面板，接着输入<code>Install Extensions</code>，跳到扩展页面，或者直接鼠标点击左侧活动栏上的扩展图标，接下来输入下面的扩展名称进行搜索然后安装。</p>
<ul>
<li><strong>ARM</strong>：使的ARM汇编代码获得语法高亮，这里主要用在启动文件上。</li>
<li><strong>C/C++</strong>：使VScode获得对C/C++语言的支持，包括智能提示，调试等。</li>
<li><strong>Chinese (Simplified) Language Pack for Visual Studio Code</strong>：VScode中文语言包。</li>
<li><strong>C++ Intellisense</strong>：提供C++智能感知功能。</li>
<li><strong>Cortex-Debug</strong>：对ARM Cortex-M内核的单片机提供调试支持。</li>
<li><strong>Cortex-Debug: Device Support Pack - STM32F1(F4,L1)</strong>：这三个芯片包分别对<strong>Cortex-Debug</strong>提供三款芯片的设备支持。</li>
<li><strong>GBKtoUTF8</strong>：因为平时的Keil的STM32工程文件大部分都是<code>GB2312</code>编码的，这个扩展可以自动将<code>GB2312</code> 转换为<code>UTF-8</code>编码。</li>
</ul>
<p>​    VScode也有丰富的主题可以选用，这里推荐两个主题和一个图标包。</p>
<ul>
<li><strong>Atom One Dark Theme</strong></li>
<li><strong>Atom One Light Theme</strong></li>
<li><strong>One Dark Pro</strong></li>
<li><strong>Material Icon Theme</strong></li>
</ul>
<h4 id="STM32CubeMX"><a href="#STM32CubeMX" class="headerlink" title="STM32CubeMX"></a>STM32CubeMX</h4><p>​    Cube基于Java运行环境，安装前要先安装<a href="https://java.com/zh_CN/download/" target="_blank" rel="noopener">JRE</a>。安装好Cube后记得安装芯片包。</p>
<p><img src="https://xz-img.oss-cn-beijing.aliyuncs.com/img/20200414134455.png" alt="image-20200414134445536"></p>
<p>在Cube主界面按图中顺序点击选择需要的芯片包安装即可。</p>
<h4 id="OpenOCD，GNU-Arm-Embedded-Toolchain，-J-Link-Software-and-Documentation-Pack"><a href="#OpenOCD，GNU-Arm-Embedded-Toolchain，-J-Link-Software-and-Documentation-Pack" class="headerlink" title="OpenOCD，GNU Arm Embedded Toolchain， J-Link Software and Documentation Pack"></a>OpenOCD，GNU Arm Embedded Toolchain， J-Link Software and Documentation Pack</h4><p>​    OpenOCD下载后是一个压缩包解压到自定地点，然后添加环境变量。在<strong><code>此电脑</code></strong>上右键，<strong><code>属性</code></strong>，点击左侧的<strong><code>高级系统设置</code></strong>，点击下方的<strong><code>环境变量</code></strong>，找到<code>Path</code>变量，点击编辑。</p>
<p><img src="https://xz-img.oss-cn-beijing.aliyuncs.com/img/20200414135118.png" alt="image-20200414135116246"></p>
<p>将OpenOCD的bin目录添加进来，点击确定即可。</p>
<p><img src="https://xz-img.oss-cn-beijing.aliyuncs.com/img/20200414135207.png" alt="image-20200414135205287"></p>
<p>使用<code>Win</code>+<code>R</code>键打开运行，输入<code>CMD</code>，进入CMD窗口后输入<code>openocd -v</code>，如果有输出证明环境变量设置成功。</p>
<p><img src="https://xz-img.oss-cn-beijing.aliyuncs.com/img/20200414135422.png" alt="image-20200414135421467"></p>
<p><strong>GNU Arm Embedded Toolchain</strong>，<strong>J-Link Software and Documentation Pack</strong>正常安装即可，然后按照上面所说的配置好环境变量。</p>
<h4 id="MinGW"><a href="#MinGW" class="headerlink" title="MinGW"></a>MinGW</h4><p>​    安装与上面相同，配置好环境变量后进入安装目录下的<code>bin</code>目录下找到<code>mingw32-make.exe</code>将其复制一份并重命名为<code>make.exe</code>。</p>
<h4 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h4><p>​    正常安装即可。</p>
<h3 id="工程创建及配置"><a href="#工程创建及配置" class="headerlink" title="工程创建及配置"></a>工程创建及配置</h3><h4 id="STM32CubeMX-1"><a href="#STM32CubeMX-1" class="headerlink" title="STM32CubeMX"></a>STM32CubeMX</h4><p>生成代码时选择<code>Makefile</code>，然后在生成的工程文件夹上右键选择通过Code打开。</p>
<p><img src="https://xz-img.oss-cn-beijing.aliyuncs.com/img/20200414143134.png" alt="image-20200414143132745"></p>
<h4 id="VScode"><a href="#VScode" class="headerlink" title="VScode"></a>VScode</h4><p>第一次打开工程的时候会报很多错误，但是编译却没有任何问题，这是因为没有告诉VScode程序的预定义量是什么，而Makefile文件里有，使用Keil的时候设置里有两个预定义量，我们这里要把这两个量告诉VScode，同时也要把包含头文件的文件夹路径告诉VScode，方便他进行代码提示纠错补全等。</p>
<p><img src="https://xz-img.oss-cn-beijing.aliyuncs.com/img/20200414143541.png" alt="image-20200414143540274"></p>
<p>使用<code>Ctrl</code>+<code>Shift</code>+<code>P</code>打开命令行，输入<code>edit configurations(json)</code>他会在工程文件夹下生成一个<code>.vscode</code>文件夹并在其中创建一个<code>c_cpp_properties.json</code>的配置文件。其中的参数修改可以参考Makefile文件。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"configurations"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"STM32"</span>,</span><br><span class="line">      <span class="attr">"includePath"</span>: [</span><br><span class="line">        <span class="string">"Drivers/CMSIS/Device/ST/STM32F1xx/Include"</span>,</span><br><span class="line">        <span class="string">"Drivers/CMSIS/Include"</span>,</span><br><span class="line">        <span class="string">"Drivers/STM32F1xx_HAL_Driver/Inc"</span>,</span><br><span class="line">        <span class="string">"Drivers/STM32F1xx_HAL_Driver/Inc/Legacy"</span>,</span><br><span class="line">        <span class="string">"Hardware"</span>,</span><br><span class="line">        <span class="string">"Inc"</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"defines"</span>: [</span><br><span class="line">        <span class="string">"STM32F103xB"</span>,</span><br><span class="line">        <span class="string">"USE_HAL_DRIVER"</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"compilerPath"</span>: <span class="string">"C:\\Program Files (x86)\\GNU Tools Arm Embedded\\9 2019-q4-major\\bin\\arm-none-eabi-gcc.exe"</span>,</span><br><span class="line">      <span class="attr">"cStandard"</span>: <span class="string">"c99"</span>,</span><br><span class="line">      <span class="attr">"cppStandard"</span>: <span class="string">"c++11"</span>,</span><br><span class="line">      <span class="attr">"intelliSenseMode"</span>: <span class="string">"$&#123;default&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"version"</span>: <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如在Makefile中可以看到下面的内容，这就是编译的时候的预定义量和文件包含路径，将其添加到<code>c_cpp_properties.json</code>中即可。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># C defines</span></span><br><span class="line">C_DEFS =  \</span><br><span class="line">-DUSE_HAL_DRIVER \</span><br><span class="line">-DSTM32F103xB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># AS includes</span></span><br><span class="line">AS_INCLUDES = </span><br><span class="line"></span><br><span class="line"><span class="comment"># C includes</span></span><br><span class="line">C_INCLUDES =  \</span><br><span class="line">-IInc \</span><br><span class="line">-IDrivers/STM32F1xx_HAL_Driver/Inc \</span><br><span class="line">-IDrivers/STM32F1xx_HAL_Driver/Inc/Legacy \</span><br><span class="line">-IDrivers/CMSIS/Device/ST/STM32F1xx/Include \</span><br><span class="line">-IDrivers/CMSIS/Include \</span><br><span class="line">-IDrivers/CMSIS/Include \</span><br><span class="line">-IHardware</span><br></pre></td></tr></table></figure>

<p>Makefile中此处是所有编译的时候要编译的c文件，当给项目添加文件的时候要在这里也添加上。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># source</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># C sources</span></span><br><span class="line">C_SOURCES =  \</span><br><span class="line">Src/main.c \</span><br><span class="line">Src/gpio.c \</span><br><span class="line">Src/spi.c \</span><br><span class="line">Src/stm32f1xx_it.c \</span><br><span class="line">Src/stm32f1xx_hal_msp.c \</span><br><span class="line">Src/stm32f1xx_hal_timebase_tim.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_gpio_ex.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_spi.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_rcc.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_rcc_ex.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_gpio.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_dma.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_cortex.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_pwr.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_flash.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_flash_ex.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_exti.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_tim.c \</span><br><span class="line">Drivers/STM32F1xx_HAL_Driver/Src/stm32f1xx_hal_tim_ex.c \</span><br><span class="line">Src/system_stm32f1xx.c  \</span><br><span class="line">Hardware/ICM20602/icm20602.c \</span><br><span class="line">Hardware/W25QXX/w25qxx.c \</span><br></pre></td></tr></table></figure>

<p>当这一步配置好之后代码中的错误就会消失了。</p>
<p>接下来要将VScode的终端换成GitBash，打开VScode设置搜索<code>shell</code>，找个下面这一项，点击在<code>settings.json</code>中编辑。</p>
<p><img src="https://xz-img.oss-cn-beijing.aliyuncs.com/img/20200414145436.png" alt="image-20200414145434997"></p>
<p>将路径改为GitBash的路径即可。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"terminal.integrated.shell.windows": "C:\\Program Files\\Git\\bin\\bash.exe",</span><br></pre></td></tr></table></figure>

<p>点击最上方的终端，新建终端，此时打开的应为Bash。</p>
<p><img src="https://xz-img.oss-cn-beijing.aliyuncs.com/img/20200414145624.png" alt="image-20200414145622712"></p>
<p>在这里输入make即可开始编译，编译生成的文件在build文件夹下。</p>
<h3 id="编译下载及调试"><a href="#编译下载及调试" class="headerlink" title="编译下载及调试"></a>编译下载及调试</h3><h4 id="编译及下载"><a href="#编译及下载" class="headerlink" title="编译及下载"></a>编译及下载</h4><p>​    上面说过了可以直接在终端输入make进行编译，VScode还具有一个tasks功能，可以自己配置一些指令。点击上方的<code>终端</code>，<code>配置默认生成任务</code>，<code>使用模板创建tasks.json</code>，<code>Others</code>，会在<code>.vscode</code>文件夹下创建一个<code>tasks.json</code>文件。将文件内容设置为如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// See https://go.microsoft.com/fwlink/?LinkId=733558</span></span><br><span class="line">    <span class="comment">// for the documentation about the tasks.json format</span></span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"2.0.0"</span>,</span><br><span class="line">    <span class="attr">"tasks"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"Compile"</span>,</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"shell"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"make"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"-j4"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"presentation"</span>: &#123;</span><br><span class="line">                <span class="attr">"echo"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"reveal"</span>: <span class="string">"always"</span>,</span><br><span class="line">                <span class="attr">"focus"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"panel"</span>: <span class="string">"shared"</span>,</span><br><span class="line">                <span class="attr">"showReuseMessage"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"clear"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"Upload"</span>,</span><br><span class="line">            <span class="attr">"type"</span>:<span class="string">"process"</span>,<span class="comment">//shell作为终端执行，process作为进程执行，使用shell出错，原因未知。</span></span><br><span class="line">            <span class="attr">"command"</span>:<span class="string">"JFlash.exe"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"-openprj$&#123;workspaceRoot&#125;/Tumble_Detector.jflash"</span>,</span><br><span class="line">                <span class="string">"-open$&#123;workspaceRoot&#125;/build/Tumble_Detector.hex"</span>,</span><br><span class="line">                <span class="string">"-auto"</span>,</span><br><span class="line">                <span class="string">"-hide"</span>,</span><br><span class="line">                <span class="string">"-jflashlog$&#123;workspaceRoot&#125;/jflashlog.txt"</span>,</span><br><span class="line">                <span class="string">"-exit"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Compile任务会调用<code>make -j4</code>指令编译工程，<code>Upload</code>指令会调用JFlash.exe进行程序的下载，使用<code>Upload</code>指令前需要先用JFlash.exe创建一个后缀名为<code>.jflash</code>的文件，并将其复制到当前工程内，其中的内容包含了跟下载有关的各种参数，jflash和hex文件的名称在此处需要修改为自己的。下载后会在当前目录下生成一个<code>jflashlog.txt</code>文件，其中是下载过程中的日志。这里如果使用的是OpenOCD进行下载的话，自行修改内容即可。</p>
<p>使用这里的任务的话，快捷键<code>Ctrl</code>+<code>P</code>，然后输入<code>task</code>和空格，会自动弹出当前有的任务，回车执行即可。</p>
<h4 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h4><p>调试的时候使用的是cortex-debug插件，JlinkGDBServer和OpenOCD的配置内容略有区别。</p>
<h5 id="Jlink-GDB-Server"><a href="#Jlink-GDB-Server" class="headerlink" title="Jlink GDB Server"></a>Jlink GDB Server</h5><p>点击VScode左侧活动栏的调试图标，如果是第一次使用的话，会让你创建<code>launch.json</code>文件，选择<code>cortex-debug</code>就可以生成一个模板。这里使用的是JlinkGDBServer，swd接口，目标芯片为f103c8t6，所以内容如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"version"</span>: <span class="string">"0.2.0"</span>,</span><br><span class="line">    <span class="attr">"configurations"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Debug(Jlink)"</span>,</span><br><span class="line">            <span class="attr">"cwd"</span>: <span class="string">"$&#123;workspaceRoot&#125;"</span>,</span><br><span class="line">            <span class="attr">"executable"</span>: <span class="string">"./build/Tumble_Detector.elf"</span>,<span class="comment">//更改为自己的路径</span></span><br><span class="line">            <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"cortex-debug"</span>,</span><br><span class="line">            <span class="attr">"servertype"</span>: <span class="string">"jlink"</span>,</span><br><span class="line">            <span class="attr">"interface"</span>: <span class="string">"swd"</span>,</span><br><span class="line">            <span class="attr">"device"</span>: <span class="string">"STM32F103C8"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OpenOCD"><a href="#OpenOCD" class="headerlink" title="OpenOCD"></a>OpenOCD</h5><p>使用OpenOCD的<code>launch.json</code>内容如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"0.2.0"</span>,</span><br><span class="line">    <span class="attr">"configurations"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"cortex-debug"</span>,</span><br><span class="line">            <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">            <span class="attr">"servertype"</span>: <span class="string">"openocd"</span>,</span><br><span class="line">            <span class="attr">"cwd"</span>: <span class="string">"$&#123;workspaceRoot&#125;"</span>,</span><br><span class="line">            <span class="attr">"executable"</span>: <span class="string">"./Tumble_Detector.elf"</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Debug (OpenOCD)"</span>,</span><br><span class="line">            <span class="attr">"device"</span>: <span class="string">"STM32F103C8"</span>,</span><br><span class="line">            <span class="attr">"configFiles"</span>: [</span><br><span class="line">                <span class="string">"./Tumble_Detector.cfg"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Tumble_Detector.cfg</code>内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source [find interface&#x2F;jlink.cfg]</span><br><span class="line">transport select swd</span><br><span class="line">source [find target&#x2F;stm32f1x.cfg]</span><br></pre></td></tr></table></figure>

<p>如果使用的是OpenOCD还需要打开OpenOCD目录下的drivers文件夹下的<code>UsbDriverTool</code>程序，在程序中找到<code>J-link</code>右键<code>Install Libusb -Winusb</code>，将Jlink的驱动换为通用usb驱动，不然OpenOCD无法连接到<code>J-link</code>，想要恢复默认驱动只要选择<code>Restore defualt driver</code>即可。</p>
<p><img src="https://xz-img.oss-cn-beijing.aliyuncs.com/img/20200414160127.png" alt="image-20200414160126415"></p>
<p>配置好后在调试界面选择运行就可以进行调试了。在调试的时候需要观察的变量使用右键添加到监视即可在左侧看到实时的值，此时的数据为十进制。</p>
<p><img src="https://xz-img.oss-cn-beijing.aliyuncs.com/img/20200414160814.png" alt="image-20200414160813332"></p>
<p>如果想显示十六进制在需要的变量上右键，编辑表达式，添加<code>,h</code>即可显示十六进制</p>
<p><img src="https://xz-img.oss-cn-beijing.aliyuncs.com/img/20200414160933.png" alt="image-20200414160932328"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">1</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
